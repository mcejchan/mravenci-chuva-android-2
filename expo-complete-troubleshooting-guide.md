# Expo Go Hello World - Kompletn√≠ troubleshooting guide

*Vytvo≈ôeno: 2025-09-08 na z√°kladƒõ √∫spƒõ≈°n√©ho rozbƒõhnut√≠ Hello World aplikace*

## üéØ C√≠l
Spustit "Hello World! üåç" aplikaci v Expo Go na Android emul√°toru v AMD64 Docker kontejneru.

## üìã Struƒçn√Ω p≈ôehled ≈ôe≈°en√≠
**Kl√≠ƒçov√Ω probl√©m**: SDK version mismatch mezi Expo Go aplikac√≠ a projektem  
**≈òe≈°en√≠**: St√°hnout spr√°vnou verzi Expo Go kompatibiln√≠ s va≈°√≠m SDK z `expo.dev/go`

## üñ•Ô∏è Verified Working Configuration

### Dev Container Environment (AMD64)
- **OS**: Ubuntu 24.04.2 LTS (Noble Numbat)
- **Architecture**: x86_64 (AMD64) 
- **Node.js**: v20.19.5 (x64 architecture)
- **NPM**: 10.8.2
- **Expo CLI**: 0.24.21 (Node.js script)
- **Java**: OpenJDK 17.0.16 (x86-64 architecture)
- **JAVA_HOME**: `/usr/lib/jvm/java-17-openjdk-amd64`
- **ADB**: v35.0.2-12147458 (x86-64 binary)

### Project Dependencies (Working)
```json
{
  "expo": "53.0.22",           // Exact installed version
  "expo-status-bar": "2.2.3", 
  "react": "19.0.0",
  "react-native": "0.79.5",
  "@babel/core": "7.28.4"
}
```

### Android Emulator (ARM64)
- **Device**: `emulator-5554`
- **Android Version**: 16 (API 35)
- **Architecture**: `arm64-v8a` (ARM64)
- **Target SDK**: 35 (minSdk: 24)
- **CPU ABI**: arm64-v8a (confirmed via `adb shell getprop ro.product.cpu.abi`)

### Expo Go (Working Version)
- **Version Name**: `2.33.22`
- **Version Code**: `379`
- **SDK Compatibility**: SDK 53
- **APK Source**: `https://expo.dev/go?device=false&platform=android&sdkVersion=53`
- **APK Size**: ~181MB
- **Architecture Support**: arm64-v8a + x86_64

### DevContainer Configuration
```json
{
  "runArgs": ["--add-host=host.docker.internal:host-gateway"],
  "mounts": [
    "source=android-sdk-amd64,target=/opt/android-sdk,type=volume",
    "source=hello_world_node_modules,target=/workspaces/.../node_modules,type=volume",
    "source=expo_cache,target=/home/vscode/.cache/expo,type=volume",
    "source=metro_cache,target=/home/vscode/.cache/metro,type=volume"
  ],
  "containerEnv": {
    "ANDROID_SDK_ROOT": "/opt/android-sdk"
  }
}
```

### Network Configuration
- **ADB Connection**: `tcp:host.docker.internal:5037`
- **Port Forwarding**: 8081, 19000, 19001
- **Expo Server**: `http://localhost:19000`
- **Metro Bundler**: `http://localhost:8081`

### Environment Variables (Critical)
```bash
export ADB_SERVER_SOCKET=tcp:host.docker.internal:5037    # ADB connection
export NODE_OPTIONS="--max_old_space_size=4096"           # Metro memory
export CHOKIDAR_USEPOLLING=1                              # File watching
export CHOKIDAR_INTERVAL=100                              # Polling interval
export ANDROID_SDK_ROOT=/opt/android-sdk                  # SDK path
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64      # Java path
```

### Performance Characteristics (AMD64 Container)
- **Metro Bundle Time**: ~56 seconds (677 modules)
- **Metro Startup Time**: 30-90 seconds (varies by system)
- **Cache Rebuild**: 1-2 minutes on first run
- **Docker Volumes**: Used for `node_modules`, expo cache, metro cache (performance critical)

---

## üèóÔ∏è Architecture Analysis: AMD64 vs ARM64

**KRITICK√â**: Tato konfigurace kombinuje AMD64 dev container s ARM64 emul√°torem.

### üñ•Ô∏è Dev Container Components (AMD64 Architecture)
All development tools run in x86-64 (AMD64) architecture:

**System Components**:
- **Container OS**: Ubuntu 24.04.2 LTS (x86-64)
- **Java**: OpenJDK 17.0.16 (x86-64)
  - Binary: `/usr/lib/jvm/java-17-openjdk-amd64/bin/java`
  - Architecture: `ELF 64-bit LSB pie executable, x86-64`
- **Node.js**: v20.19.5 (x64)
  - Binary: `/usr/bin/node`  
  - Architecture: `ELF 64-bit LSB executable, x86-64`

**Android Development Tools**:
- **ADB**: v35.0.2-12147458 (x86-64)
  - Binary: `/opt/android-sdk/platform-tools/adb`
  - Architecture: `ELF 64-bit LSB pie executable, x86-64`
- **Android SDK CLI Tools**: Shell scripts (architecture-agnostic)
  - sdkmanager, avdmanager: `sh script, ASCII text executable`

**JavaScript/Node.js Tools**:
- **Expo CLI**: v0.24.21 (Node.js script, runs on x64 Node.js)
  - Type: `Node.js script executable, ASCII text`
- **npm packages**: All JavaScript/TypeScript (architecture-agnostic)

### üì± Android Emulator Components (ARM64 Architecture)  
The emulator runs ARM64 architecture:

- **Emulator Target**: arm64-v8a (ARM64)
- **Android System**: Android 16 API 35 (ARM64)
- **Expo Go APK**: Built for arm64-v8a architecture
  - Type: `Android package (APK), with gradle app-metadata.properties`
  - Primary ABI: arm64-v8a (confirmed via `adb shell getprop ro.product.cpu.abi`)
- **React Native Bridge**: ARM64 native components in Expo Go

### üîÑ Cross-Architecture Communication
- **ADB Connection**: AMD64 ADB client ‚Üí ARM64 emulator (via TCP socket)
- **Metro Bundler**: AMD64 Node.js serves JavaScript ‚Üí ARM64 Expo Go executes
- **Network Bridge**: `tcp:host.docker.internal:5037` for container‚Üíhost‚Üíemulator communication
- **Hot Reload**: JavaScript code (architecture-agnostic) ‚Üí ARM64 JavaScript engine

### ‚ö†Ô∏è Performance Implications  
- **Metro Bundler**: ~30-90 seconds startup time (AMD64 overhead + cross-arch communication)
- **Hot Reload**: Normal speed (~1-2 seconds) - JavaScript is architecture-agnostic
- **APK Installation**: Slower due to cross-architecture ADB communication
- **File System Access**: Docker volume mounts provide good performance for `node_modules`

### üß© Why This Configuration Works
1. **JavaScript Layer**: React Native/Expo apps are primarily JavaScript (architecture-agnostic)
2. **Native Bridge**: Expo Go provides the native ARM64 runtime
3. **Development Tools**: All AMD64 tools communicate via network protocols
4. **Docker Rosetta**: Docker Desktop handles AMD64‚ÜíARM64 emulation transparently

---

## üö® Hlavn√≠ probl√©my a ≈ôe≈°en√≠ (chronologicky)

### 1. Probl√©m: "Metro bundler se nespou≈°t√≠ na portu 8081"

**Symptom**: 
```bash
curl -I http://localhost:8081
# Connection refused
```

**P≈Øvodn√≠ diagn√≥za**: Metro bundler failure  
**Skuteƒçn√° p≈ô√≠ƒçina**: Metro bundler startuje pomalu (30-60 sekund v AMD64 kontejneru)

**‚úÖ ≈òe≈°en√≠**:
```bash
# 1. Vyƒçistit cache
rm -rf .expo .expo-shared

# 2. Spustit s patience a spr√°vn√Ωmi parametry
export NODE_OPTIONS="--max_old_space_size=4096"
export CHOKIDAR_USEPOLLING=1
export CHOKIDAR_INTERVAL=100
EXPO_NO_MDNS=1 npx expo start --host=localhost --clear

# 3. Poƒçkat 30-90 sekund a≈æ se Metro spust√≠
# Waiting on http://localhost:19000 -> Metro bundler se spou≈°t√≠
```

**Diagnostick√© p≈ô√≠kazy**:
```bash
# Ovƒõ≈ôit, ≈æe Metro bƒõ≈æ√≠
ss -lntp | grep -E ':(8081|19000|19001)'
# LISTEN 0 0 *:8081 *:* users:(("node",pid=XXX,fd=23)) ‚úÖ

# Test Metro odpovƒõdi
curl -I http://localhost:8081  # HTTP/1.1 200 OK ‚úÖ
curl -I http://localhost:19000 # HTTP/1.1 200 OK ‚úÖ
```

### 2. Probl√©m: "This project requires a newer version of Expo Go"

**Symptom na emul√°toru**:
```
ERROR Project is incompatible with this version of Expo Go
‚Ä¢ The installed version of Expo Go is for SDK 54.
‚Ä¢ The project you opened uses SDK 53.
```

**P≈ô√≠ƒçina**: SDK version mismatch  
- Expo Go: SDK 54 (nejnovƒõj≈°√≠ z Google Play)
- N√°≈° projekt: SDK 53

**‚úÖ ≈òe≈°en√≠**: St√°hnout spr√°vnou Expo Go verzi z `expo.dev/go`

```bash
# Krok 1: Odebrat souƒçasnou Expo Go
export ADB_SERVER_SOCKET=tcp:host.docker.internal:5037
adb -s emulator-5554 uninstall host.exp.exponent

# Krok 2: St√°hnout spr√°vnou verzi pro SDK 53
SDK=53

# Pro ARM64 emul√°tor (device=true)
APK_URL=$(curl -fsSL "https://expo.dev/go?device=true&platform=android&sdkVersion=$SDK" \
  | grep -Eo 'https://[^"]+\.apk' | head -1)

# Fallback pro x86_64 emul√°tor (device=false) - ƒçasto funguje l√©pe
if [ -z "$APK_URL" ]; then
  APK_URL=$(curl -fsSL "https://expo.dev/go?device=false&platform=android&sdkVersion=$SDK" \
    | grep -Eo 'https://[^"]+\.apk' | head -1)
fi

echo "APK URL: $APK_URL"
curl -fL "$APK_URL" -o ExpoGo-SDK${SDK}-correct.apk

# Krok 3: Ovƒõ≈ôit sta≈æen√Ω APK
ls -la ExpoGo-SDK${SDK}-correct.apk  # Mƒõl by m√≠t ~170-200MB

# Ovƒõ≈ôit architekturu (voliteln√©)
unzip -l ExpoGo-SDK${SDK}-correct.apk | grep -E 'lib/(arm64-v8a|x86_64)/' | head -5

# Krok 4: Nainstalovat spr√°vnou verzi
adb -s emulator-5554 install -r ExpoGo-SDK${SDK}-correct.apk

# Krok 5: Ovƒõ≈ôit verzi
adb -s emulator-5554 shell dumpsys package host.exp.exponent | grep versionName
# versionName=2.33.22  (pro SDK 53)
```

### 3. Probl√©m: ADB connection issues

**Symptom**: 
```bash
adb devices
# List of devices attached
# (pr√°zdn√©)
```

**‚úÖ ≈òe≈°en√≠**:
```bash
# V AMD64 Docker kontejneru v≈ædy pou≈æ√≠t:
export ADB_SERVER_SOCKET=tcp:host.docker.internal:5037

# Pak v≈°echny ADB p≈ô√≠kazy:
adb -s emulator-5554 devices
adb -s emulator-5554 install app.apk
adb -s emulator-5554 shell "command"
```

### 4. Probl√©m: Port forwarding issues

**Symptom**: Aplikace se p≈ôipoj√≠, ale zobrazuje connection errors

**‚úÖ ≈òe≈°en√≠**: Spr√°vn√© nastaven√≠ port forwarding
```bash
export ADB_SERVER_SOCKET=tcp:host.docker.internal:5037

# 1. Vyƒçistit existuj√≠c√≠ forwarding
adb -s emulator-5554 reverse --remove-all

# 2. Nastavit v≈°echny pot≈ôebn√© porty
for p in 8081 19000 19001; do 
  adb -s emulator-5554 reverse tcp:$p tcp:$p
done

# 3. Ovƒõ≈ôit nastaven√≠
adb -s emulator-5554 reverse --list
```

### 5. Probl√©m: Cache corruption

**Symptom**: Aplikace se naƒç√≠t√°, ale zobrazuje star√© chyby nebo se chov√° nep≈ôedv√≠datelnƒõ

**‚úÖ ≈òe≈°en√≠**: Vyƒçistit v≈°echny cache
```bash
# Expo cache
rm -rf .expo .expo-shared

# Metro cache 
npx metro clean-cache  # nebo npx expo start --clear

# Emul√°tor cache (pokud pot≈ôeba)
adb -s emulator-5554 shell pm clear host.exp.exponent
```

---

## üì± Kompletn√≠ working workflow

Toto je funkƒçn√≠ postup od nuly do bƒõ≈æ√≠c√≠ aplikace:

```bash
# === P≈ò√çPRAVA PROST≈òED√ç ===
cd hello-world
export ADB_SERVER_SOCKET=tcp:host.docker.internal:5037

# === KROK 1: VYƒåISTIT VSE ===
# Cache
rm -rf .expo .expo-shared

# Pokud m√°≈° starou Expo Go
adb -s emulator-5554 uninstall host.exp.exponent || true

# === KROK 2: ST√ÅHNOUT SPR√ÅVNOU EXPO GO ===
# Z√≠skat SDK verzi z package.json
SDK=$(grep '"expo"' package.json | sed 's/.*"~\([0-9]*\)\..*/\1/')
echo "Detected SDK: $SDK"

# St√°hnout spr√°vnou verzi
APK_URL=$(curl -fsSL "https://expo.dev/go?device=false&platform=android&sdkVersion=$SDK" \
  | grep -Eo 'https://[^"]+\.apk' | head -1)

if [ -n "$APK_URL" ]; then
  echo "Downloading: $APK_URL"
  curl -fL "$APK_URL" -o ExpoGo-SDK${SDK}.apk
  
  # Nainstalovat
  adb -s emulator-5554 install -r ExpoGo-SDK${SDK}.apk
  
  # Ovƒõ≈ôit verzi
  VERSION=$(adb -s emulator-5554 shell dumpsys package host.exp.exponent | grep versionName)
  echo "Installed: $VERSION"
else
  echo "ERROR: Could not find APK URL for SDK $SDK"
  exit 1
fi

# === KROK 3: NASTAVIT PORT FORWARDING ===
adb -s emulator-5554 reverse --remove-all
for p in 8081 19000 19001; do 
  adb -s emulator-5554 reverse tcp:$p tcp:$p
done

# === KROK 4: SPUSTIT EXPO SERVER ===
export NODE_OPTIONS="--max_old_space_size=4096"
export CHOKIDAR_USEPOLLING=1
export CHOKIDAR_INTERVAL=100

echo "Starting Expo server (this may take 30-90 seconds)..."
EXPO_NO_MDNS=1 npx expo start --host=localhost --clear &
EXPO_PID=$!

# Poƒçkat a≈æ se Metro spust√≠
echo "Waiting for Metro bundler to start..."
for i in {1..180}; do
  if curl -s http://localhost:8081 > /dev/null 2>&1; then
    echo "‚úÖ Metro bundler is running on port 8081"
    break
  fi
  if [ $i -eq 180 ]; then
    echo "‚ùå Metro bundler failed to start after 3 minutes"
    kill $EXPO_PID 2>/dev/null || true
    exit 1
  fi
  sleep 1
done

# === KROK 5: SPUSTIT APLIKACI ===
echo "Launching app on emulator..."
adb -s emulator-5554 shell am start -a android.intent.action.VIEW -d "exp://127.0.0.1:19000"

echo "‚úÖ App launched! Check emulator for 'Hello World! üåç'"
```

---

## üîß Diagnostick√© p≈ô√≠kazy

### Ovƒõ≈ôit stav slu≈æeb
```bash
# Metro bundler bƒõ≈æ√≠?
curl -I http://localhost:8081
# HTTP/1.1 200 OK ‚úÖ

# Expo server bƒõ≈æ√≠?
curl -I http://localhost:19000  
# HTTP/1.1 200 OK ‚úÖ

# Kter√© porty naslouchaj√≠?
ss -lntp | grep -E ':(8081|19000|19001)'

# Procesy
ps -ef | grep -E 'node.*(expo|metro)' | grep -v grep
```

### Ovƒõ≈ôit emul√°tor
```bash
export ADB_SERVER_SOCKET=tcp:host.docker.internal:5037

# Emul√°tor p≈ôipojen?
adb devices
# emulator-5554	device ‚úÖ

# Expo Go nainstalovan√©?
adb -s emulator-5554 shell pm list packages | grep host.exp.exponent
# package:host.exp.exponent ‚úÖ

# Verze Expo Go
adb -s emulator-5554 shell dumpsys package host.exp.exponent | grep versionName

# Port forwarding spr√°vnƒõ?
adb -s emulator-5554 reverse --list

# Co bƒõ≈æ√≠ na emul√°toru?
adb -s emulator-5554 shell dumpsys activity activities | grep -A5 -B5 expo
```

### Debug aplikace
```bash
# Expo logy
npx expo start --host=localhost --clear

# Aplikace se naƒç√≠t√°?
# Sleduj v√Ωstup: "Android ./index.js ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë 97.6%"

# Crash logy z emul√°toru
adb -s emulator-5554 logcat | grep -i expo
```

---

## üìö Slep√© uliƒçky (vyhni se jim)

### ‚ùå Co NEFUNGUJE:
1. **Upgrading to non-existent SDK versions**: SDK 54 nebyl dostupn√Ω v npm
2. **Using wrong APK sources**: Direct GitHub releases ƒçasto 404
3. **Installing ARM64 APK on x86_64 emulator**: Architecture mismatch  
4. **Skipping cache cleanup**: Star√© cache zp≈Øsobuje weird behavior
5. **Impatience with Metro startup**: Metro v AMD64 kontejneru trv√° 30-90s
6. **Wrong ADB socket**: V Docker kontejneru mus√≠≈° pou≈æ√≠t `host.docker.internal:5037`

### ‚ùå Co jsme zkou≈°eli ale NEPOMOHLO:
```bash
# Tyto p≈ô√≠kazy byly ne√∫ƒçinn√©:
npx expo install expo@~54.0.0  # SDK neexistoval
curl github.com/expo/direct-releases  # 404 errors  
adb install rychle-bez-cekani  # Architecture mismatch
rm pouze .expo  # Cache bylo v√≠c m√≠st
expo eject  # √öplnƒõ zmƒõnilo architekturu
```

---

## üèÅ Fin√°ln√≠ ovƒõ≈ôen√≠ √∫spƒõchu

Pokud v≈°e funguje, mƒõl bys vidƒõt:

### Termin√°l Output (SUCCESS):
```bash
Starting project at /workspaces/mravenci-chuva-android-amd64/hello-world
Starting Metro Bundler
warning: Bundler cache is empty, rebuilding (this may take a minute)
Waiting on http://localhost:19000
Logs for your project will appear below.

# Pozor: M≈Ø≈æe se objevit error message o SDK (ignoruj ho):
ERROR Project is incompatible with this version of Expo Go
‚Ä¢ The installed version of Expo Go is for SDK 54.
‚Ä¢ The project you opened uses SDK 53.

# Ale potom zaƒçne bundling (to je spr√°vnƒõ!):
Android ./index.js ‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  9.5% ( 4/13)
Android ./index.js ‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 19.8% ( 33/144)
...
Android ./index.js ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë 99.7% (676/677)
Android ./index.js ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë 99.9% (677/677)

# √öSPƒöCH! üéâ
Android Bundled 56601ms index.js (677 modules)
```

### Emul√°tor Screen:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ     Hello World! üåç     ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### HTTP Endpoints:
```bash
curl -I http://localhost:8081
# HTTP/1.1 200 OK (Metro bundler)

curl -I http://localhost:19000  
# HTTP/1.1 200 OK (Expo dev server)

curl http://localhost:19000
# {"id":"278c6b66-4ab7...","expo":{"name":"hello-world"...}}
```

### Verification Commands:
```bash
# Ovƒõ≈ô Expo Go verzi
adb -s emulator-5554 shell dumpsys package host.exp.exponent | grep versionName
# versionName=2.33.22 ‚úÖ

# Ovƒõ≈ô running aplikaci
adb -s emulator-5554 shell dumpsys activity activities | grep -i expo
# topResumedActivity: host.exp.exponent/...MainActivity ‚úÖ (ne ErrorActivity!)

# Ovƒõ≈ô port forwarding
adb -s emulator-5554 reverse --list
# 8081 -> 8081
# 19000 -> 19000  
# 19001 -> 19001 ‚úÖ
```

---

## üéØ Kl√≠ƒçov√© poznatky pro budouc√≠ projekty

1. **V≈ædy kontroluj SDK compatibility** mezi projektem a Expo Go
2. **Pou≈æ√≠vej `expo.dev/go` pro stahov√°n√≠** spr√°vn√Ωch verz√≠, ne GitHub releases
3. **V Docker kontejnerech poƒç√≠tej s pomal√Ωm startupem** Metro bundleru (30-90s)
4. **Cache cleanup je kritick√Ω** p≈ôi troubleshootingu
5. **ADB v kontejneru** vy≈æaduje `host.docker.internal:5037`
6. **Port forwarding mus√≠ b√Ωt kompletn√≠** (8081, 19000, 19001)

---

**Status**: ‚úÖ **COMPLETE GUIDE** - Tento postup dovede Hello World aplikaci od nuly do funkƒçn√≠ho stavu bez slep√Ωch uliƒçek.